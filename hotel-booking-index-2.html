<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Hotel Booking Assistant</title>
  <script src="https://unpkg.com/react@18.2.0/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone@7.24.7/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState } = React;

    // Mock hotel data
    const hotels = [
      { id: 1, name: "Parisian Charm", city: "Paris", price: 120, taxes: 15, fees: 10, amenities: ["Free WiFi", "Breakfast"] },
      { id: 2, name: "Louvre Retreat", city: "Paris", price: 140, taxes: 18, fees: 12, amenities: ["Gym", "City View"] },
      { id: 3, name: "Downtown Inn", city: "New York", price: 200, taxes: 25, fees: 15, amenities: ["Pool", "Free Parking"] }
    ];

    // Improved chatbot logic
    function parseUserInput(input) {
      const lowerInput = input.toLowerCase().trim();
      
      // Flexible regex for city (e.g., "in Paris", "Paris hotels", "hotels in paris")
      const cityMatch = lowerInput.match(/(?:in\s+|\b)([a-z\s]+)(?:hotel|under|$)/i);
      // Flexible regex for budget (e.g., "under $150", "below 150", "$150 or less")
      const budgetMatch = lowerInput.match(/(?:under|below|less than)\s+\$?(\d+)/i);
      
      const city = cityMatch ? cityMatch[1].trim() : null;
      const budget = budgetMatch ? parseInt(budgetMatch[1]) : Infinity;

      // Debug logging
      console.log("Parsed city:", city, "Parsed budget:", budget);

      // Filter hotels
      const results = hotels.filter(hotel => {
        const totalPrice = hotel.price + hotel.taxes + hotel.fees;
        const cityMatches = !city || hotel.city.toLowerCase().trim() === city.toLowerCase().trim();
        return cityMatches && totalPrice <= budget;
      });

      if (!city && !budgetMatch) {
        return { message: "Please specify a city or budget (e.g., 'Find a hotel in Paris under $150').", results: [] };
      }

      if (results.length === 0) {
        return { 
          message: `No hotels found ${city ? `in ${city}` : ''} under $${budget}. Try increasing your budget or changing the city.`, 
          results: [] 
        };
      }

      return {
        message: `Found ${results.length} hotel(s) ${city ? `in ${city}` : ''} under $${budget}:`,
        results
      };
    }

    // React Component
    function App() {
      const [input, setInput] = useState("");
      const [chatHistory, setChatHistory] = useState([
        { sender: "bot", message: "Hi! I'm your AI booking assistant. Try: 'Find a hotel in Paris under $150' or 'Hotels in New York under $300'." }
      ]);

      const handleSubmit = (e) => {
        e.preventDefault();
        if (!input.trim()) return;

        const response = parseUserInput(input);
        setChatHistory([...chatHistory, { sender: "user", message: input }, { sender: "bot", ...response }]);
        setInput("");
      };

      return (
        <div className="min-h-screen bg-gray-100 flex flex-col items-center p-4">
          <h1 className="text-2xl font-bold text-blue-600 mb-4">AI Hotel Booking Assistant</h1>
          <div className="w-full max-w-lg bg-white rounded-lg shadow-md p-4">
            <div className="h-80 overflow-y-auto mb-4 p-2 border border-gray-200 rounded">
              {chatHistory.map((msg, index) => (
                <div key={index} className={`mb-2 ${msg.sender === 'user' ? 'text-right' : 'text-left'}`}>
                  <span className={`inline-block p-2 rounded-lg ${msg.sender === 'user' ? 'bg-blue-100 text-blue-800' : 'bg-gray-200 text-gray-800'}`}>
                    {msg.message}
                  </span>
                  {msg.results && msg.results.length > 0 && (
                    <div className="mt-2">
                      {msg.results.map(hotel => (
                        <div key={hotel.id} className="border p-3 rounded-lg mb-2 bg-white">
                          <h3 className="text-md font-semibold">{hotel.name}</h3>
                          <p><strong>City:</strong> {hotel.city}</p>
                          <p><strong>Base Price:</strong> ${hotel.price}</p>
                          <p><strong>Taxes:</strong> ${hotel.taxes}</p>
                          <p><strong>Fees:</strong> ${hotel.fees}</p>
                          <p><strong>Total:</strong> ${hotel.price + hotel.taxes + hotel.fees}</p>
                          <p><strong>Amenities:</strong> {hotel.amenities.join(", ")}</p>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              ))}
            </div>
            <form onSubmit={handleSubmit} className="flex">
              <input
                type="text"
                value={input}
                onChange={(e) => setInput(e.target.value)}
                placeholder="e.g., Find a hotel in Paris under $150"
                className="flex-grow p-2 border border-gray-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
              <button
                type="submit"
                className="bg-blue-600 text-white px-4 py-2 rounded-r-lg hover:bg-blue-700"
              >
                Send
              </button>
            </form>
          </div>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById("root"));
  </script>
</body>
</html>